<?xml version="1.0"?>
<launch>
  <!-- Default parameters -->
  <arg name="input/obstacle_pointcloud" default="/perception/obstacle_segmentation/pointcloud"/> 
  <arg name="input/raw_pointcloud" default="/sensing/lidar/concatenated/pointcloud"/>
  <arg name="output" default="/perception/occupancy_grid_map/map"/>
  <arg name="use_intra_process" default="false"/>
  <arg name="use_multithread" default="false"/>
  <arg name="pointcloud_container_name" default="pointcloud_container"/>
  <arg name="occupancy_grid_map_method" default="pointcloud_based_occupancy_grid_map"/>
  <arg name="occupancy_grid_map_param_path" default="$(find-pkg-share autoware_probabilistic_occupancy_grid_map)/config/pointcloud_based_occupancy_grid_map.param.yaml"/>
  <arg name="occupancy_grid_map_updater" default="binary_bayes_filter"/>
  <arg name="occupancy_grid_map_updater_param_path" default="$(find-pkg-share autoware_probabilistic_occupancy_grid_map)/config/binary_bayes_filter_updater.param.yaml"/>
  
  <!-- First launch the container -->
  <include file="$(find-pkg-share autoware_launch)/launch/pointcloud_container.launch.py">
    <arg name="use_multithread" value="$(var use_multithread)"/>
    <arg name="container_name" value="$(var pointcloud_container_name)"/>
  </include>
  
  <!-- Then launch the occupancy grid map nodes to load into that container -->
  <include file="$(find-pkg-share autoware_launch)/launch/occupancy_grid_map/pointcloud_based_occupancy_grid_map.launch.py">
    <arg name="input/obstacle_pointcloud" value="$(var input/obstacle_pointcloud)"/>
    <arg name="input/raw_pointcloud" value="$(var input/raw_pointcloud)"/>
    <arg name="output" value="$(var output)"/>
    <arg name="use_intra_process" value="$(var use_intra_process)"/>
    <arg name="use_multithread" value="$(var use_multithread)"/>
    <arg name="use_pointcloud_container" value="true"/>
    <arg name="pointcloud_container_name" value="$(var pointcloud_container_name)"/>
    <arg name="param_file" value="$(var occupancy_grid_map_param_path)"/>
    <arg name="updater_type" value="$(var occupancy_grid_map_updater)"/>
    <arg name="updater_param_file" value="$(var occupancy_grid_map_updater_param_path)"/>
  </include>
</launch>
