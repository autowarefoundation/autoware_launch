<launch>
  <arg name="launch_driver" default="true"/>
  <arg name="host_ip" default="255.255.255.255"/>
  <arg name="vehicle_mirror_param_file"/>
  <arg name="pointcloud_container_name" default="pointcloud_container"/>
  <arg name="use_distortion_corrector" default="true"/>
  <arg name="output_as_sensor_frame" default="false"/>

  <group>
    <push-ros-namespace namespace="lidar"/>

    <group>
      <push-ros-namespace namespace="top"/>
      <include file="$(find-pkg-share common_sensor_launch)/launch/velodyne_VLP16.launch.xml">
        <arg name="max_range" value="250.0"/>
        <arg name="sensor_frame" value="velodyne_top"/>
        <arg name="sensor_ip" value="127.0.0.1"/>
        <arg name="host_ip" value="$(var host_ip)"/>
        <arg name="data_port" value="2368"/>
        <arg name="scan_phase" value="300.0"/>
        <arg name="launch_driver" value="$(var launch_driver)"/>
        <arg name="vehicle_mirror_param_file" value="$(var vehicle_mirror_param_file)"/>
        <arg name="container_name" value="pointcloud_container"/>
        <arg name="udp_only" value="true"/>
      </include>
    </group>

    <load_composable_node target="$(var pointcloud_container_name)">
      <composable_node pkg="topic_tools"
                       plugin="topic_tools::RelayNode"
                       name="pointcloud_relay_ring_to_concat"
                       namespace="concatenated">
        <param name="input_topic" value="/sensing/lidar/top/pointcloud_before_sync"/>
        <param name="output_topic" value="/sensing/lidar/concatenated/pointcloud"/>
        <param name="type" value="sensor_msgs/msg/PointCloud2"/>
        <param name="reliability" value="best_effort"/>
      </composable_node>
    </load_composable_node>

  </group>

</launch>
