autoware_system_design_format: v0.1.0

name: TrafficLightRecognitionDetectorWholeImage.module

instances:
  - name: map_based_detector
    entity: TrafficLightMapBasedDetector.node

  - name: detection
    entity: TensorrtYolox.node
  - name: selector
    entity: TrafficLightSelector.node

  - name: classifier_car
    entity: TrafficLightClassifierCar.node
  - name: classifier_pedestrian
    entity: TrafficLightClassifierPedestrian.node

  - name: merger
    entity: TrafficLightCategoryMerger.node

external_interfaces:
  input:
    - name: vector_map
    - name: image
    - name: camera_info
    - name: route
  output:
    - name: classification/traffic_signals
    - name: detection/rois

connections:
  - from: input.vector_map
    to: map_based_detector.input.vector_map
  - from: input.route
    to: map_based_detector.input.route
  - from: input.camera_info
    to: map_based_detector.input.camera_info

  - from: input.image
    to: detection.input.image

  - from: detection.output.objects
    to: selector.input.detected_rois
  - from: map_based_detector.output.expected_rois
    to: selector.input.expect_rois
  - from: map_based_detector.output.rough_rois
    to: selector.input.rough_rois
  - from: input.camera_info
    to: selector.input.camera_info
  - from: selector.output.traffic_rois
    to: output.detection/rois

  - from: input.image
    to: classifier_car.input.image
  - from: selector.output.traffic_rois
    to: classifier_car.input.rois

  - from: input.image
    to: classifier_pedestrian.input.image
  - from: selector.output.traffic_rois
    to: classifier_pedestrian.input.rois

  - from: classifier_car.output.traffic_signals
    to: merger.input.car_signals
  - from: classifier_pedestrian.output.traffic_signals
    to: merger.input.pedestrian_signals
  - from: merger.output.traffic_signals
    to: output.classification/traffic_signals
